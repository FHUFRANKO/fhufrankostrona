(()=>{const onAds=()=>location.pathname.toLowerCase().includes("ogloszenia");const onHome=()=>location.pathname.replace(/\/+$/,"")==="";const ENV=window.ENV||{};const URL=ENV.SUPABASE_URL;const KEY=ENV.SUPABASE_ANON_KEY;const TABLE=(ENV.SUPABASE_TABLE||"ogloszenia");const empty="nie ma jeszcze żadnych ogłoszeń";const main=document.querySelector("main")||document.body;const ensureRoot=(id)=>{let r=document.getElementById(id);if(!r){r=document.createElement("section");r.id=id;r.style.margin="12px 0";(main).prepend(r);}return r};const looksLikeCard=(el)=>{const t=(el.textContent||"").toLowerCase();return /(pln|zł|mercedes|ford|transit|vivaro|bus|dostawcz|citan|sprzedaż|rocznik|przebieg)/.test(t)&&(el.querySelector("img")||el.querySelector("picture"))};const hideMockGridNearby=(headerText)=>{const h=[...document.querySelectorAll("h1,h2,h3")].find(x=>(x.textContent||"").toLowerCase().includes(headerText));if(h){let c=h.parentElement;let tries=0;while(c&&tries++<5){const kids=[...c.querySelectorAll(":scope > *")];const grids=kids.filter(k=>{const ch=[...k.children];return ch.length>=6&&ch.filter(looksLikeCard).length>=6});if(grids.length){grids.forEach(g=>g.style.display="none");return;}c=c.parentElement;}}};const hideMocks=()=>{document.querySelectorAll("[class*=mock],[data-mock],[data-demo],[class*=demo],[class*=sample]").forEach(n=>n.style.display="none");if(onAds()) hideMockGridNearby("busy i samochody"); if(onHome()) hideMockGridNearby("wyróżnione busy");};const render=(root,arr=[])=>{if(!arr.length){root.textContent=empty;return;}root.innerHTML=arr.map(it=>{const t=it.title??it.tytul??"Ogłoszenie";const d=it.description??it.opis??"";const p=it.price??it.cena??"";const img=it.image??it.zdjecie??"";return "<article style=\"border:1px solid #eee;border-radius:12px;padding:12px;margin:8px 0;display:flex;gap:12px;align-items:flex-start\">"+(img?"<img src=\""+img+"\" alt=\"\" style=\"width:140px;height:100px;object-fit:cover;border-radius:8px\">":"")+"<div><h3 style=\"margin:0 0 6px 0;font-size:1.05rem\">"+t+"</h3>"+(d?"<p style=\"margin:0 0 6px 0\">"+d+"</p>":"")+(p?"<div style=\"font-weight:600\">"+p+"</div>":"")+"</div></article>"}).join("")};const yes=v=>v===true||v==="true";const filterReal=a=>(Array.isArray(a)?a:[]).filter(x=>{const t=String((x.title||x.tytul||"")).toLowerCase();return !(yes(x.mock)||yes(x.isMock)||yes(x.fake)||yes(x.test)||t.includes("mock"))});const load=()=>{hideMocks();const root=ensureRoot(onAds()?"ogloszenia-root":"ogloszenia-home-root");if(!URL||!KEY){render(root,[]);return;}const endpoint=URL.replace(/\/$/,"")+"/rest/v1/"+encodeURIComponent(TABLE)+"?select=*,title,description,price,image,active,created_at&active=eq.true&order=created_at.desc";fetch(endpoint,{headers:{apikey:KEY,Authorization:"Bearer "+KEY,"Content-Type":"application/json"},cache:"no-store"}).then(r=>r.ok?r.json():[]).then(d=>render(root,filterReal(d))).catch(()=>render(root,[]))};const ready=()=>{if(document.readyState==="complete"||document.readyState==="interactive"){setTimeout(load,0);}else{document.addEventListener("DOMContentLoaded",load,{once:true});}};ready();const mo=new MutationObserver(()=>{if(onAds()||onHome()){hideMocks();ensureRoot(onAds()?"ogloszenia-root":"ogloszenia-home-root");}});mo.observe(document.documentElement,{subtree:true,childList:true});})();